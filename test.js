const assert = require('assert')
const EventEmitter = require('events')
const proxyquire =  require('proxyquire')

// create reader with serialport stub
const Reader = proxyquire('./index.js', { 'serialport': EventEmitter })

describe('Reader', () => {
  describe('#on("data")', () => {
    it('should provide a message', (done) => {

      const reader = new Reader({ port: '/dev/ttyUSB0' })
      const serialStub = reader._port
            
      reader.on('data', (msg) => {
        assert.equal(msg.total, 197.4635, 'Total should be given')
        assert.equal(msg.t1, 197.4635, 't1 should be given')
        assert.equal(msg.t2, 0, 't2 should be given')
        done()
      })

      serialStub.emit('data', '00b800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b1b1b1b010101017605003a95a0620062007263010176010105001387360b0649534b010e1f5a783c010163c25e007605003a95a1620062007263070177010b0649534b010e1f5a783c070100620affff72620165002582c17777078181c78203ff010101010449534b0177070100000009ff010101010b0649534b010e1f5a783c0177070100010800ff650000018201621e52ff5900000000001e216b0177070100010801ff0101621e52ff5900000000001e216b0177070100010802ff0101621e52ff5900000000000000000177070100100700ff0101621b520055000000d50177078181c78205ff010101018302e22de327ff72f076d2fbdb01cf88d170872a19232939373871d28b6725e7dae09b22976cd40eaf5fb409c74ac5493f300101016389f5007605003a95a26200620072630201710163d131001b1b1b1b1a004f441b1b1b1b010101017605003a95a3620062007263010176010105001387370b0649534b010e1f5a783c0101633d41007605003a95a4620062007263070177010b0649534b010e1f5a783c070100620affff72620165002582c37777078181c78203ff010101010449534b0177070100000009ff010101010b0649534b010e1f5a783c0177070100010800ff650000018201621e52ff5900000000001e216c0177070100010801ff0101621e52ff5900000000001e216c0177070100010802ff0101621e52ff5900000000000000000177070100100700ff0101621b520055000000d90177078181c78205ff010101018302e22de327ff72f076d2fbdb01cf88d170872a19232939373871d28b6725e7dae09b22976cd40eaf5fb409c74ac5493f30010101637c0b007605003a95a562006200726302017101633791001b1b1b1b1a007a3c1b1b1b1b010101017605003a95a6620062007263010176010105001387380b0649534b010e1f5a783c010163e67d007605003a95a7620062007263070177010b0649534b010e1f5a783c070100620affff72620165002582c57777078181c78203ff010101010449534b0177070100000009ff010101010b0649534b010e1f5a783c0177070100010800ff650000018201621e52ff5900000000001e216d0177070100010801ff0101621e52ff5900000000001e216d0177070100010802ff0101621e52ff5900000000000000000177070100100700ff0101621b520055000000da0177078181c78205ff010101018302e22de327ff72f076d2fbdb01cf88d170872a19232939373871d28b6725e7dae09b22976cd40eaf5fb409c74ac5493f30010101630f28007605003a95a862006200726302017101635926001b1b1b1b1a00ed3d1b1b1b1b010101017605003a95a9620062007263010176010105001387390b0649534b010e1f5a783c0101635cee007605003a95aa620062007263070177010b0649534b010e1f5a783c070100620affff72620165002582c67777078181c78203ff010101010449534b0177070100000009ff010101010b0649534b010e1f5a783c0177070100010800ff650000018201621e52ff5900000000001e216e0177070100010801ff0101621e52ff5900000000001e216e0177070100010802ff0101621e52ff5900000000000000000177070100100700ff0101621b520055000000da0177078181c78205ff010101018302e22de327ff72f076d2fbdb01cf88d170872a19232939373871d28b6725e7dae09b22976cd40eaf5fb409c74ac5493f30010101637c77007605003a95ab6200620072630201710163ead8001b1b1b1b1a00c8af1b1b1b1b010101017605003a95ac6200620072630101760101050013873a0b0649534b010e1f5a783c0101635dce007605003a95ad620062007263070177010b0649534b010e1f5a783c070100620affff72620165002582c87777078181c78203ff010101010449534b0177070100000009ff010101010b0649534b010e1f5a783c0177070100010800ff650000018201621e52ff5900000000001e216f0177070100010801ff0101621e52ff5900000000001e216f0177070100010802ff0101621e52ff5900000000000000000177070100100700ff0101621b520055000000da0177078181c78205ff010101018302e22de327ff72f076d2fbdb01cf88d170872a19232939373871d28b6725e7dae09b22976cd40eaf5fb409c74ac5493f30010101630a3b007605003a95ae62006200726302017101632ed3001b1b1b1b1a009ce01b1b1b1b010101017605003a95af6200620072630101760101050013873b0b0649534b010e1f5a783c010163a2d1007605003a95b0620062007263070177010b0649534b010e1f5a783c070100620affff72620165002582ca7777078181c78203ff010101010449534b0177070100000009ff010101010b0649534b010e1f5a783c0177070100010800ff650000018201621e52ff5900000000001e21700177070100010801ff0101621e52ff5900000000001e21700177070100010802ff0101621e52ff5900000000000000000177070100100700ff0101621b520055000000db0177078181c78205ff010101018302e22de327ff72f076d2fbdb01cf88d170872a19232939373871d28b6725e7dae09b22976cd40eaf5fb409c74ac5493f3001010163fd3c007605003a95b1620062007263020171016327be001b1b1b1b1a00e07d1b1b1b1b010101017605003a95b26200620072630101760101050013873c0b0649534b010e1f5a783c0101638112007605003a95b3620062007263070177010b0649534b010e1f5a783c070100620affff72620165002582cb7777078181c78203ff010101010449534b0177070100000009ff010101010b0649534b010e1f5a783c0177070100010800ff650000018201621e52ff5900000000001e21710177070100010801ff0101621e52ff5900000000001e21710177070100010802ff0101621e52ff5900000000000000000177070100100700ff0101621b520055000000da0177078181c78205ff010101018302e22de327ff72f076d2fbdb01cf88d170872a19232939373871d28b6725e7dae09b22976cd40eaf5fb409c74ac5493f300101016302f5007605003a95b46200620072630201710163e3b5001b1b1b1b1a0057db1b1b1b1b010101017605003a95b56200620072630101760101050013873d0b0649534b010e1f5a783c010163b28e007605003a95b6620062007263070177010b0649534b010e1f5a783c070100620affff72620165002582cd7777078181c78203ff010101010449534b0177070100000009ff010101010b0649534b010e1f5a783c0177070100010800ff650000018201621e52ff5900000000001e21720177070100010801ff0101621e52ff5900000000001e21720177070100010802ff0101621e52ff5900000000000000000177070100100700ff0101621b520055000000d90177078181c78205ff010101018302e22de327ff72f076d2fbdb01cf88d170872a19232939373871d28b6725e7dae09b22976cd40eaf5fb409c74ac5493f30010101633907007605003a95b76200620072630201710163504b001b1b1b1b1a00c47b1b1b1b1b010101017605003a95b86200620072630101760101050013873e0b0649534b010e1f5a783c0101633aa1007605003a95b9620062007263070177010b0649534b010e1f5a783c070100620affff72620165002582cf7777078181c78203ff010101010449534b0177070100000009ff010101010b0649534b010e1f5a783c0177070100010800ff650000018201621e52ff5900000000001e21730177070100010801ff0101621e52ff5900000000001e21730177070100010802ff0101621e52ff5900000000000000000177070100100700ff0101621b520055000000d70177078181c78205ff010101018302e22de327ff72f076d2fbdb01cf88d170872a19232939373871d28b6725e7dae09b22976cd40eaf5fb409c74ac5493f30010101634627007605003a95ba62006200726302017101633efc001b1b1b1b1a009db71b1b1b1b010101017605003a95bb6200620072630101760101050013873f0b0649534b010e1f5a783c010163c5be007605003a95bc620062007263070177010b0649534b010e1f5a783c070100620affff72620165002582d07777078181c78203ff010101010449534b0177070100000009ff010101010b0649534b010e1f5a783c0177070100010800ff650000018201621e52ff5900000000001e21740177070100010801ff0101621e52ff5900000000001e21740177070100010802ff0101621e52ff5900000000000000000177070100100700ff0101621b520055000000d70177078181c78205ff010101018302e22de327ff72f076d2fbdb01cf88d170872a19232939373871d28b6725e7dae09b22976cd40eaf5fb409c74ac5493f3001010163d55e007605003a95bd6200620072630201710163d85c001b1b1b1b1a00ccea1b1b1b1b010101017605003a95be620062007263010176010105001387400b0649534b010e1f5a783c01016319b2007605003a95bf620062007263070177010b0649534b010e1f5a783c070100620affff72620165002582d27777078181c78203ff010101010449534b0177070100000009ff010101010b0649534b010e1f5a783c0177070100010800ff650000018201621e52ff5900000000001e21750177070100010801ff0101621e52ff5900000000001e21750177070100010802ff0101621e52ff5900000000000000000177070100100700ff0101621b520055000000d60177078181c78205ff010101018302e22de327ff72f076d2fbdb01cf88d170872a19232939373871d28b6725e7dae09b22976cd40eaf5fb409c74ac5493f30010101633c0f007605003a95c062006200726302017101637cb5001b1b1b1b1a0004181b1b1b1b010101017605003a95c1620062007263010176010105001387410b0649534b010e1f5a783c010163dd7c007605003a95c2620062007263070177010b0649534b010e1f5a783c070100620affff72620165002582d47777078181c78203ff010101010449534b0177070100000009ff010101010b0649534b010e1f5a783c0177070100010800ff650000018201621e52ff5900000000001e21760177070100010801ff0101621e52ff5900000000001e21760177070100010802ff0101621e52ff5900000000000000000177070100100700ff0101621b520055000000d90177078181c78205ff010101018302e22de327ff72f076d2fbdb01cf88d170872a19232939373871d28b6725e7dae09b22976cd40eaf5fb409c74ac5493f30010101636ba7007605003a95c36200620072630201710163cf4b001b1b1b1b1a006b441b1b1b1b010101017605003a95c4620062007263010176010105001387420b0649534b010e1f5a783c010163dc5c007605003a95c5620062007263070177010b0649534b010e1f5a783c070100620affff72620165002582d57777078181c78203ff010101010449534b0177070100000009ff010101010b0649534b010e1f5a783c0177070100010800ff650000018201621e52ff5900000000001e21770177070100010801ff0101621e52ff5900000000001e21770177070100010802ff0101621e52ff5900000000000000000177070100100700ff0101621b520055000000d30177078181c78205ff010101018302e22de327ff72f076d2fbdb01cf88d170872a19232939373871d28b6725e7dae09b22976cd40eaf5fb409c74ac5493f30010101631c23007605003a95c662006200726302017101630b40001b1b1b1b1a00a28e1b1b1b1b010101017605003a95c7620062007263010176010105001387430b0649534b010e1f5a783c0101632343007605003a95c8620062007263070177010b0649534b010e1f5a783c070100620affff72620165002582d77777078181c78203ff010101010449534b0177070100000009ff010101010b0649534b010e1f5a783c0177070100010800ff650000018201621e52ff5900000000001e21780177070100010801ff0101621e52ff5900000000001e21780177070100010802ff0101621e52ff5900000000000000000177070100100700ff0101621b520055000000d60177078181c78205ff010101018302e22de327ff72f076d2fbdb01cf88d170872a19232939373871d28b6725e7dae09b22976cd40eaf5fb409c74ac5493f30010101636f2e007605003a95c96200620072630201710163475c001b1b1b1b1a0003df1b1b1b1b010101017605003a95ca620062007263010176010105001387440b0649534b010e1f5a783c010163129f007605003a95cb620062007263070177010b0649534b010e1f5a783c070100620affff72620165002582d97777078181c78203ff010101010449534b0177070100000009ff010101010b0649534b010e1f5a783c0177070100010800ff650000018201621e52ff5900000000001e21790177070100010801ff0101621e52ff5900000000001e21790177070100010802ff0101621e52ff5900000000000000000177070100100700ff0101621b520055000000d60177078181c78205ff010101018302e22de327ff72f076d2fbdb01cf88d170872a19232939373871d28b6725e7dae09b22976cd40eaf5fb409c74ac5493f300101016355d9007605003a95cc62006200726302017101638357001b1b1b1b1a006ab3')
    })
  })
})
